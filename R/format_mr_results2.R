#' Split outcome column 
#'
#' This function takes the outcome column from the results generated by mr() and splits it into separate columns for 'outcome name', 'consortium' and 'year'
#'
#' @param mr_res Results from mr()
#'
#' @export
#' @return data frame
split_outcome <- function(mr_res)
{
	Pos<-grep("\\|\\|",mr_res$outcome) #the "||"" indicates that the outcome column was derived from summary data in MR-Base. Sometimes it wont look like this e.g. if the user has supplied their own outcomes
	mr_res$trait<-mr_res$outcome
	Outcome<-mr_res$outcome[Pos]
	Vars<-unlist(strsplit(Outcome,split= "\\|\\|"))
	Vars<-trim(Vars)
	Trait<-Vars[seq(1,length(Vars),by=3)]
	Consortium<-Vars[seq(2,length(Vars),by=3)]
	Year<-Vars[seq(3,length(Vars),by=3)]
	mr_res$trait[Pos]<-Trait
	mr_res$consortium<-NA
	mr_res$consortium[Pos]<-Consortium
	mr_res$year<-NA
	mr_res$year[Pos]<-Year
	return(mr_res)
}

#' Generate odds ratios 
#'
#' This function takes b and se from mr() and generates odds ratios and 95 percent confidence intervals
#'
#' @param mr_res Results from mr()
#'
#' @export
#' @return data frame		
generate_odds_ratios <- function(mr_res) 
{
	mr_res$lo_ci <- mr_res$b - 1.96 * mr_res$se
	mr_res$up_ci <- mr_res$b + 1.96 * mr_res$se
	mr_res$or <- exp(mr_res$b)
	mr_res$or_lci95 <- exp(mr_res$lo_ci)
	mr_res$or_uci95 <- exp(mr_res$up_ci)
	return(mr_res)
}

#' Subset MR-results on method
#'
#' This function takes MR results from mr() and restricts to a single method per exposure x disease combination 
#'
#' @param mr_res Results from mr()
#' @param single_snp_method Which of the single SNP methosd to use when only 1 SNP was used to estimate the causal effect? Default="Wald ratio"
#' @param multi_snp_method Which of the multi-SNP methods to use when there was more than 1 SNPs used to estimate the causal effect? Default="Inverse variance weighted"
#'
#' @export
#' @return data frame.
subset_on_method <- function(mr_res, single_snp_method="Wald ratio", multi_snp_method="Inverse variance weighted")
{
	dat <- subset(mr_res, (nsnp==1 & method==single_snp_method) | (nsnp > 1 & method == multi_snp_method))
	return(dat)

}